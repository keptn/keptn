apiVersion: apps/v1
kind: Deployment
metadata:
  name: gatekeeper-service
  namespace: keptn
spec:
  selector:
    matchLabels:
      run: gatekeeper-service
  replicas: 1
  template:
    metadata:
      labels:
        run: gatekeeper-service
    spec:
      containers:
      - name: gatekeeper-service
        image: keptn/gatekeeper-service:latest
        ports:
        - containerPort: 8080
        resources:
          requests:
            memory: "256Mi"
            cpu: "500m"
          limits:
            memory: "256Mi"
            cpu: "500m"
        env:
        - name: CONFIGURATION_SERVICE
          value: 'http://configuration-service.keptn.svc.cluster.local:8080'
        - name: EVENTBROKER
          value: 'http://event-broker.keptn.svc.cluster.local/keptn'
        - name: DATASTORE
          value: 'http://mongodb-datastore.keptn-datastore.svc.cluster.local:8080'
---
apiVersion: v1
kind: Service
metadata:
  name: gatekeeper-service
  namespace: keptn
  labels:
    run: gatekeeper-service
spec:
  ports:
  - port: 8080
    protocol: TCP
  selector:
    run: gatekeeper-service

---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "1"
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{},"name":"gatekeeper-service-evaluation-done-distributor","namespace":"keptn"},"spec":{"replicas":1,"selector":{"matchLabels":{"run":"distributor"}},"template":{"metadata":{"labels":{"run":"distributor"}},"spec":{"containers":[{"env":[{"name":"PUBSUB_URL","value":"nats://keptn-nats-cluster"},{"name":"PUBSUB_TOPIC","value":"sh.keptn.events.evaluation-done"},{"name":"PUBSUB_RECIPIENT","value":"gatekeeper-service"}],"image":"keptn/distributor:latest","name":"distributor","ports":[{"containerPort":8080}],"resources":{"limits":{"cpu":"500m","memory":"128Mi"},"requests":{"cpu":"50m","memory":"32Mi"}}}]}}}}
  creationTimestamp: "2020-05-08T07:50:00Z"
  generation: 1
  name: gatekeeper-service-evaluation-done-distributor
  namespace: keptn
  resourceVersion: "594181"
  selfLink: /apis/extensions/v1beta1/namespaces/keptn/deployments/gatekeeper-service-evaluation-done-distributor
  uid: 84dff9d8-9100-11ea-9b9a-42010a80002c
spec:
  progressDeadlineSeconds: 600
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      run: distributor
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        run: distributor
    spec:
      containers:
        - env:
            - name: PUBSUB_URL
              value: nats://keptn-nats-cluster
            - name: PUBSUB_TOPIC
              value: sh.keptn.>
            - name: PUBSUB_RECIPIENT
              value: gatekeeper-service
          image: keptn/distributor:latest
          imagePullPolicy: Always
          name: distributor
          ports:
            - containerPort: 8080
              protocol: TCP
          resources:
            limits:
              cpu: 500m
              memory: 128Mi
            requests:
              cpu: 50m
              memory: 32Mi
