<div fxFlexFill>
  <div class="container" fxFlex fxLayout="column">
    <div class="mb-3 settings-section" fxFlex fxLayout="column">
      <h2>Git upstream repository</h2>
      <p class="mt-0 mb-3">Instructions, how to set your Git provider can be found in the
        <a [href]="'/manage/git_upstream/' | keptnUrl" target="_blank">Git-based upstream documentation</a>
      </p>
      <form [formGroup]="gitUpstreamForm" class="mb-3" fxLayout="row" fxLayoutAlign="none end">
        <dt-form-field class="mr-3">
          <dt-label>Git remote URL</dt-label>
          <input formControlName="gitUrl" type="text" required dtInput placeholder="https://git-repo.com/repo.git"/>
          <dt-error>Must not be empty</dt-error>
        </dt-form-field>
        <dt-form-field class="mr-3">
          <dt-label>Git user</dt-label>
          <input formControlName="gitUser" type="text" required dtInput placeholder="Username"/>
          <dt-error>Must not be empty</dt-error>
        </dt-form-field>
        <dt-form-field class="mr-3">
          <dt-label>Token</dt-label>
          <input formControlName="gitToken" (focus)="gitTokenControl.value.length > 0 && gitTokenControl.value.includes('*********') ? gitTokenControl.setValue('') : null" type="text" dtInput placeholder="Token"/>
          <dt-error>Must not be empty</dt-error>
        </dt-form-field>
        <button [disabled]="gitUpstreamForm.invalid || !gitUpstreamForm.dirty || isGitUpstreamInProgress" (click)="setGitUpstream()" dt-button>
          <dt-loading-spinner *ngIf="isGitUpstreamInProgress" aria-label="Setting Git upstream URL"></dt-loading-spinner>
          Set Git upstream
        </button>
      </form>
    </div>
    <div class="mb-3 settings-section">
      <h2>Danger Zone</h2>
      <div class="danger-zone p-3">
        <h4 class="pt-0 mt-0">Delete project</h4>
        <div fxLayout="row" fxLayoutAlign="space-between center">
          <span>Once deleted, it will be gone forever.</span>
          <button dt-button class="danger-button" (click)="openProjectDeletionDialog()">Delete this project</button>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #deleteProjectDialog let-data>
  <div class="mb-3" fxLayout="row" fxLayoutAlign="space-between center">
    <div class="bold">Are you absolutely sure?</div>
    <button dt-icon-button variant="nested" (click)="deletionDialogRef.close()"><dt-icon name="abort"></dt-icon></button>
  </div>
  <div class="mt-3" fxLayout="column" fxLayoutAlign="stretch" [formGroup]="deletionConfirmationForm">
    <div class="mb-1">This action cannot be undone. This will permanently delete the <span class="bold">{{data.projectName}}</span> project.</div>
    <div class="mb-3">Please type in <span class="bold">{{data.projectName}}</span> to confirm deletion.</div>
    <div class="mb-2">
      <dt-form-field>
        <input [formControl]="deletionConfirmationControl" class="wide-input" type="text" dtInput [placeholder]="data.projectName" />
      </dt-form-field>
    </div>
    <button dt-button class="danger-button" (click)="deleteProject()" [disabled]="deletionConfirmationForm.invalid">
      I understand the consequences, delete this project
      <dt-loading-spinner *ngIf="isDeleteProjectInProgress"></dt-loading-spinner>
    </button>
    <div class="mt-3" *ngIf="deletionError">
      <span class="error">{{ deletionError }}</span>
    </div>
  </div>
</ng-template>
