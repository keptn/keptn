<div fxLayout="column" fxLayoutGap="5px">
  <div *ngFor="let event of _events;trackBy: identifyEvent">
    <ktb-selectable-tile (click)="selectEvent(event)" [error]="event.isFaulty() && (!event.isProblem() || event.isFaulty() != event.isSuccessful())" [success]="event.isProblem() && event.isSuccessful()" [selected]="_selectedEvent == event" *ngIf="event">
      <ktb-selectable-tile-header>
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="5px">
          <dt-icon *ngIf="event.isFinished()" class="event-icon" [class.error]="event.isProblem() && event.isFaulty() && !event.isSuccessful()" [name]="event.getIcon()"></dt-icon>
          <button *ngIf="!event.isFinished()" class="m-0 p-0" dt-button disabled variant="nested">
            <dt-loading-spinner aria-label="Task is running..."></dt-loading-spinner>
          </button>
          <div class="mt-1 mb-1" fxLayout="row" fxLayoutAlign="start center">
            <p class="m-0" [class.error]="event.isProblem() && event.isFaulty() && !event.isSuccessful()">
              <span class="bold" [textContent]="event.getLabel()"></span>
              <span *ngIf="!event.isFinished(); else finishedText"> started</span>
              <ng-template #finishedText>
                <span *ngIf="!event.isFaulty(); else faultyText"> succeeded</span>
                <ng-template #faultyText>
                  <span> failed</span>
                </ng-template>
              </ng-template>
            </p>
          </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="5px">
          <p class="m-0 small" *ngIf="event.getShortImageName()"><span class="m-0" [textContent]="event.getShortImageName()"></span></p>
          <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="5px">
            <dt-tag-list aria-label="stages">
              <dt-tag *ngFor="let stage of event.getStages()" [textContent]="stage" [class.error]="stage == event.isFaulty() && stage != event.isSuccessful()" [class.warning]="stage == event.isWarning()" [class.highlight]="event.hasPendingApproval(stage)" (click)="$event.stopPropagation();selectEvent(event, stage)"></dt-tag>
            </dt-tag-list>
          </div>
        </div>
      </ktb-selectable-tile-header>

      <p class="m-0 small" [textContent]="event.time | amCalendar:dateUtil.getCalendarFormats()"></p>
      <p class="m-0 small" *ngIf="event.data.ProblemTitle" [textContent]="event.data.ProblemTitle"></p>
    </ktb-selectable-tile>
  </div>
</div>
